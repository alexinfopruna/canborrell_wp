!function(d,c,p){function e(){}d.extend(e.prototype,{container:"",k:0,props:"",init:function(){this.btnClick()},setter:function(e=""){this.props=e},btnClick:function(){var o=this;d(p).on("click",".magee_shortcodes",function(){o.shortcodePopup(d(this))}),d(p).on("click","a.magee_shortcode_item",function(){var e=d(this);d(this).css({"pointer-events":"none"}).append('<i style="float:right;" class="fa fa-spinner fa-spin"></i>'),o.shortcodeGenerator(e)}),d(p).on("click","a.magee-shortcodes-home",function(){d("a.magee_shortcode_item").css({"pointer-events":"auto"}),d("a.magee_shortcode_item").find(".fa-spinner").remove(),o.goBack()}),d(p).on("click",".magee-shortcode-insert",function(e){d(this).addClass("button-secondary").removeClass("button-primary").css({"pointer-events":"none"}).append('<i class="fa fa-spinner fa-spin"></i>'),o.shortcodeInsert()}),d(p).on("click",".magee-upload-button",function(e){var t=d(this);e.preventDefault(),o.uplaodButton(t)}),d(p).on("click","a.child-clone-row-remove.magee-shortcodes-button",function(){var e=d(this);o.removeColumn(e)}),d(p).on("click","a.child-shortcode-add",function(){o.addColumn()}),d(p).on("click",".choose-show",function(){var e=d(this);o.choiceControl(e)}),d(p).on("click",".magee_custom_icon",function(){var e=d(this);o.chooseIcon(e)}),d(p).on("click",".magee-shortcodes-preview",function(e){e.stopPropagation(),o.shortcodePrivew()}),d(p).on("click",".magee-preview-delete",function(){o.deletePrivew()}),d(p).on("keyup","#magee_shortcode_search",function(){o.shortcodeSearch(d(this))})},initOptions:function(){var o=this;o.numberControl(),d(".choose-show").each(function(){d(this).find(".choose-show-param").each(function(){var e=""==(e=d(this).parents(".param-item").find(".magee-form-choose").val())?"no":e;d(this).attr("name")==e?d(this).css("display","block"):d(this).css("display","none"),"Yes"==d(this).text()?d(this).css({"background-color":"#CCF7D5",color:"#17A534","font-weight":"bold"}):"No"==d(this).text()&&d(this).css({"background-color":"#FFDEDE",color:"#ff0000","font-weight":"bold"})})}),d(p).find(".wp-color-picker-field").each(function(e){var t=d(this);o.colorpickerControl(t)})},colorOptions:function(){var o=this;return{change:function(e,t){o.container.find(".wp-color-picker-field").each(function(){var e=d(this).parents(".wp-picker-container").find(".wp-color-result").css("background-color");d(this).css("background-color",e);var t=0;d(this).parents(".wp-picker-container").find("a.iris-square-value").css("top")&&(t=parseInt(d(this).parents(".wp-picker-container").find("a.iris-square-value").css("top").replace("px","")));e=parseInt(d(this).parents(".wp-picker-container").find("div.iris-slider-offset span").css("bottom"));t<87&&e<97?d(this).css("color","black"):d(this).css("color","white")})},defaultColor:!0}},shortcodePrivew:function(){var e=d("#TB_window").height()-40;d("#preview").css({display:"block",position:"absolute",width:"1200px",height:e,top:"0px",left:"-200px"});e="<iframe id='magee-sc-form-preview' class='magee-sc-form-preview' width='100%' height='"+(d("#preview").height()-d(".preview-title").height()-50).toString()+"'></iframe>";0<d("#magee-sc-form-preview").length&&d("#magee-sc-form-preview").remove(),d("#preview").append(e);var t=this.container.find("form").serializeArray(),o=this.container.find("form").find("input#magee-shortcode").val();d.ajax({type:"POST",url:ajaxurl,dataType:"html",data:{action:"preview_js",shortcode:o},success:function(e){d("#magee-sc-form-preview").contents().find("head").append(e),d("#magee-sc-form-preview").contents().find("body").append("<img alt='loading' class='loading' src='"+magee_params.themeurl+"/images/AjaxLoader.gif' />"),d.ajax({type:"POST",url:ajaxurl,dataType:"html",data:{name:o,action:"live_preview",preview:t},success:function(e){e+='<script>if (typeof jQuery !== "undefined") {var magee_shortcodes = jQuery().MageeShortcodes(); magee_shortcodes.init();}<\/script>',d("#magee-sc-form-preview").contents().find(".loading").remove(),d("#magee-sc-form-preview").contents().find("body").append(e),d("#magee-sc-form-preview").contents().find("a").on("click",function(e){"#"==d(this).attr("href")&&e.preventDefault()})},error:function(){}})},error:function(){}})},deletePrivew:function(){d("#preview").css("display","none"),d("#magee-sc-form-preview").remove()},shortcodeSearch:function(e){var t,e=e.val();""!==e?(d(".magee_shortcodes_list li").hide(),t=new RegExp(e,"i"),d(".magee_shortcodes_list li").each(function(){d(this).text().match(t)&&d(this).show()})):d(".magee_shortcodes_list li").show()},shortcodePopup:function(e={}){var t="shortcode-generator",o=e.data("target");void 0!==e&&e.identifier&&(t=e.identifier);var i=MSEditorL10n.insertShortcode+" "+MSEditorL10n.ver+"<span class='shortcode_show_name'></span><a class='link-doc' target='_blank' href='"+MSGenerator.docUrl+"'>"+MSEditorL10n.doc+"</a><a class='link-forum' target='_blank' href='"+MSGenerator.forumUrl+"'>"+MSEditorL10n.forums+"</a>",e=d(c).height()-150;tb_show(i,ajaxurl+"?action=magee_shortcodes_popup&popup="+t+"&target="+o+"&width=800&height="+e)},goBack:function(){var e=d(c).height()-150;d("#TB_ajaxContent").css("height",e),d("#magee-shortcodes-settings").hide(),d("#TB_footer").remove(),d("#magee-shortcodes-settings-innter").html(""),d(".magee_shortcodes_list").show(),d("#magee_shortcode_search").show(),d("#TB_ajaxWindowTitle").find("i").remove(),d("#TB_ajaxWindowTitle").find("span").html(""),d("#TB_ajaxWindowTitle").html(d("#TB_ajaxWindowTitle").html().replace(/&nbsp;/g,"")),d("#preview").css("display","none"),d("#magee-sc-form-preview").remove()},chooseIcon:function(e){e.each(function(){d(this).parents(".param-item").find(".iconpicker").css("display","block"),d(this).parents(".param-item").find(".iconpicker i").click(function(){var e=d(this).data("name");d(this).addClass("selected").siblings().removeClass("selected"),d(this).parents(".param-item").find("input").val(e),d(this).parent(".iconpicker").css("display","none")})})},uplaodButton:function(e){if(upid=e.attr("data-upid"),e.hasClass("remove-image"))return d('.magee-upload-button[data-upid="'+upid+'"]').parent().find("img").attr("src","").hide(),d('.magee-upload-button[data-upid="'+upid+'"]').parent().find("input").val("").change(),void d('.magee-upload-button[data-upid="'+upid+'"]').text("Upload").removeClass("remove-image");var o=wp.media.frames.file_frame=wp.media({title:MSEditorL10n.select_img,button:{text:MSEditorL10n.select_img},frame:"post",multiple:!1});o.open(),d(".media-menu a:contains(Insert from URL)").remove(),o.on("select",function(){o.state().get("selection").map(function(e){e=e.toJSON(),d('.magee-upload-button[data-upid="'+upid+'"]').parent().find("img").attr("src",e.url).show(),d('.magee-upload-button[data-upid="'+upid+'"]').parent().find("input").val(e.url).change()}),d('.magee-upload-button[data-upid="'+upid+'"]').text("Remove").addClass("remove-image"),d(".media-modal-close").trigger("click")}),o.on("insert",function(){var e=o.state().get("selection"),t=d(".attachment-display-settings .size").val();e.map(function(e){(e=e.toJSON()).url=(t?e.sizes[t]:e).url,d('.magee-upload-button[data-upid="'+upid+'"]').parent().find("img").attr("src",e.url).show(),d('.magee-upload-button[data-upid="'+upid+'"]').parent().find("input").val(e.url).change()}),d('.magee-upload-button[data-upid="'+upid+'"]').text("Remove").addClass("remove-image"),d(".media-modal-close").trigger("click")})},addColumn:function(){var e='<div class="param-item"><a id="child-shortcode-remove" href="#" class="child-clone-row-remove magee-shortcodes-button ">'+MSEditorL10n.remove+"</a></div>",t=this.container.find(".magee-shortcodes-settings-inner-clone");t.find(".wp-picker-container").each(function(){var e='<input type="text" class="magee-form-text magee-cinput wp-color-picker-field" name="'+d(this).find("input").attr("name")+'" id="'+d(this).find("input").attr("id")+'" value="'+d(this).find("input").val()+'" />';d(this).replaceWith(e)}),$clone=t.html();t=d(".column-shortcode-inner").length,e='<div class="column-shortcode-inner">'+$clone+e+"</div>";if(d(".shortcode-add").before(e),$source=d(".column-shortcode-inner").eq(t),0<$source.find(".magee-upload-button").length)for(var o=$source.find(".magee-upload-button").length,i=0;i<o;i++){this.k++;var n=$source.find(".magee-upload-button").eq(i).attr("data-upid");$source.find(".magee-upload-button").eq(i).attr("data-upid",n+this.k)}this.initOptions()},removeColumn:function(e){e.parents(".column-shortcode-inner").remove()},numberControl:function(){this.container.find(".magee-form-number").each(function(){var t=d(this),o=parseInt(d(this).attr("max")),i=parseInt(d(this).parent(".field").find(".probar").width()),n=i/o,e=parseInt(d(this).val()),e=n*e.toString();d(this).parent(".field").find(".probar-control").css("left",e),d(this).parents(".param-item").find(".probar").click(function(e){e=((e=e||c.event).clientX-d(this).parents(".param-item").find(".probar").offset().left)/i*100;d(this).parents(".param-item").find(".probar-control").css("left",e.toString()+"%"),Math.round(parseInt(d(this).parents(".param-item").find(".probar-control").css("left"))/n)>o?t.val(o):t.val(Math.round(parseInt(d(this).parents(".param-item").find(".probar-control").css("left"))/n))}),d(this).change(function(){parseInt(d(this).val())>o?d(this).parents(".param-item").find(".probar-control").css("left","100%"):(newleft=n*parseInt(d(this).val()).toString(),d(this).parents(".param-item").find(".probar-control").css("left",newleft))});var a,r,s=0;d(this).parents(".param-item").find(".probar-control").mousedown(function(e){s=1,e=e||c.event,a=d(this).parents(".param-item").find(".probar").offset().left,r=a+i}),d(p).mousemove(function(e){1==s&&(e=(e=e||c.event).clientX,r<e||e<a?(r<e&&t.parents(".param-item").find(".probar-control").css("left","100%"),e<a&&t.parents(".param-item").find(".probar-control").css("left","0%")):(e=(e-a)/i*100,t.parents(".param-item").find(".probar-control").css("left",e.toString()+"%"),t.val(Math.round(parseInt(t.parents(".param-item").find(".probar-control").css("left"))/n))))}),d(p).mouseup(function(){s=0})})},choiceControl:function(e){var t;e.find(".choose-show-param").eq(0).is(":hidden")?(t=e.find(".choose-show-param").eq(0).attr("name"),e.find(".choose-show-param").eq(0).css("display","block"),e.find(".choose-show-param").eq(1).css("display","none"),e.parents(".param-item").find(".magee-form-choose").val(t),"Yes"==e.find(".choose-show-param").eq(1).text()&&e.css({"background-color":"#CCF7D5",color:"#17A534","font-weight":"bold"}),"No"==e.find(".choose-show-param").eq(1).text()&&e.css({"background-color":"#FFDEDE",color:"#ff0000","font-weight":"bold"})):(t=e.find(".choose-show-param").eq(1).attr("name"),e.find(".choose-show-param").eq(1).css("display","block"),e.find(".choose-show-param").eq(0).css("display","none"),e.parents(".param-item").find(".magee-form-choose").val(t),"Yes"==e.find(".choose-show-param").eq(0).text()&&e.css({"background-color":"#CCF7D5",color:"#17A534","font-weight":"bold"}),"No"==e.find(".choose-show-param").eq(0).text()&&e.css({"background-color":"#FFDEDE",color:"#ff0000","font-weight":"bold"}))},colorpickerControl:function(e){var t=this.colorOptions();e.wpColorPicker(t);t=e.attr("value");e.css("background-color",t);var o=0,i=e.parents(".wp-picker-container");i.find(".wp-picker-holder").mouseover(function(e){o=0,e.cancelBubble=!0}),i.find(".wp-picker-holder").mouseout(function(e){o=1,e.cancelBubble=!0}),d(p).mousedown(function(){1==o&&i.find(".wp-picker-holder").css("display","none")}),i.find(".wp-color-result").click(function(){i.find(".wp-picker-holder").css("display","block")})},shortcodeGenerator:function(e){var t=this.colorOptions(),r=e.data("shortcode"),s=e.parents("div#magee_shortcodes_container form");this.container=d("#magee_shortcodes_container");var c=this;d.ajax({type:"POST",url:ajaxurl,dataType:"html",data:{shortcode:r,action:"magee_shortcode_form"},success:function(e){if(s.find(".magee_shortcodes_list").hide(),d("#magee_shortcode_search").hide(),s.find("#magee-shortcodes-settings").show(),s.find("#magee-shortcodes-settings .current_shortcode").text(r),s.find("#magee-shortcodes-settings #magee-shortcode").val(r),s.find("#magee-shortcodes-settings-inner").html(e),d(".magee-shortcodes-settings-inner-clone").html(s.find(".column-shortcode-inner").html()),0<s.find(".magee-upload-button").length)for(var t=s.find(".magee-upload-button").length,o=0;o<t;o++){c.k++;var i=s.find(".magee-upload-button").eq(o).attr("data-upid");s.find(".magee-upload-button").eq(o).attr("data-upid",i+c.k)}var n='<div class="TB_footer" id="TB_footer">';n+='<div class="magee-shortcode-return">'+MSEditorL10n.top+"</div>",n+='<div class="magee-shortcode-actions magee-shortcode-clearfix">',n+='<a class="button button-large magee-shortcodes-home"  href="javascript:void(0);"><img src="'+MSGenerator.imgUrl+'list.png"/></a>',n+='<a class="button button-primary button-large magee-shortcodes-preview" >',n+='<img style="margin-bottom:-3px;margin-right:5px" src="'+MSGenerator.imgUrl+'preview.png"/>'+MSEditorL10n.preview,n+="</a>",n+='<a class="button button-primary button-large magee-shortcode-insert"  href="javascript:void(0);">',n+='<img style="margin-bottom:-3px;margin-right:5px" src="'+MSGenerator.imgUrl+'insert_shortcode.png"/>'+MSEditorL10n.insert,n+="</a>",n+="</div>",n+="</div>",d("#TB_window").append(n);var a=d("#TB_window").outerHeight(),e=d("#TB_title").outerHeight(),n=d("#TB_footer").outerHeight();d("#TB_ajaxContent").css({height:a-e-n-15}),d("#TB_ajaxWindowTitle> span:first-child").before("&nbsp;<i class='fa fa-angle-right title_icon' ></i>&nbsp;"),d("#TB_ajaxWindowTitle> span").append(d("#magee-shortcodes-settings-inner h2").text()),d("#no_preview").val()&&d(".TB_footer .magee-shortcodes-preview").css("display","none"),d("#TB_ajaxContent").scroll(function(){400<=d(this).scrollTop()?d(".magee-shortcode-return").css("display","block"):d(".magee-shortcode-return").css("display","none")}),d(".magee-shortcode-return").click(function(){d("#TB_ajaxContent").animate({scrollTop:0},500)}),d(".magee-form-datetime").datetimepicker({dateFormat:"yy-mm-dd HH:ii:ss",allowTimes:[]})},complete:function(){c.container.find(".wp-color-picker-field").wpColorPicker(t),c.initOptions()},error:function(){}})},shortcodeInsert:function(){var e=this.container.find("form"),t=e.find("input#magee-shortcode").val(),o=this.container.data("target");console.log("target",o),d.ajax({type:"POST",url:ajaxurl,dataType:"html",data:{shortcode:t,action:"magee_create_shortcode",attr:e.serializeArray()},success:function(e){c.MSG.props?c.MSG.props.props.setAttributes({content:c.MSG.props.props.attributes.content+e}):(c.magee_wpActiveEditor=c.wpActiveEditor,c.wpActiveEditor=o,c.wp.media.editor.insert(e),c.wpActiveEditor=c.magee_wpActiveEditor),tb_remove()},error:function(){tb_remove()}})}}),d.fn.MageeShortcodesApi=function(){return(new e).setter},d(function(){(new e).init()}),c.MSG={},c.MSG.Api=jQuery().MageeShortcodesApi()}(window.jQuery,window,document);